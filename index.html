<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Fast Metadata Generator 2026</title>
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --card: #ffffff; --dark: #0f172a; --success: #10b981; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: var(--card); border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; }
        
        .tabs { display: flex; background: var(--dark); }
        .tab-btn { flex: 1; padding: 15px; border: none; background: none; color: #94a3b8; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .tab-btn.active { color: white; border-bottom: 3px solid var(--primary); background: rgba(255,255,255,0.05); }

        .tab-content { padding: 25px; display: none; }
        .tab-content.active { display: block; }

        .input-group { margin-bottom: 20px; }
        label { display: block; font-weight: 600; margin-bottom: 8px; }
        input[type="password"], input[type="file"] { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; box-sizing: border-box; }
        
        .btn-main { background: var(--primary); color: white; border: none; padding: 14px 20px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 16px; font-weight: bold; transition: 0.2s; }
        .btn-main:hover { background: #1d4ed8; }
        .btn-main:disabled { background: #94a3b8; cursor: not-allowed; }

        .api-link { display: inline-block; margin-top: 10px; color: var(--primary); text-decoration: none; font-size: 14px; font-weight: 600; }
        .api-link:hover { text-decoration: underline; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border-bottom: 1px solid #e2e8f0; text-align: left; }
        .img-preview { width: 60px; height: 60px; object-fit: cover; border-radius: 6px; }

        .status { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .s-wait { background: #e2e8f0; color: #475569; }
        .s-run { background: #dbeafe; color: #1e40af; animation: pulse 1.5s infinite; }
        .s-done { background: #d1fae5; color: #065f46; }
        .s-err { background: #fee2e2; color: #991b1b; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        .result-item { border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #fff; }
        .copy-box { display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 10px; border-radius: 6px; margin-top: 5px; }
        .salin-btn { background: #64748b; color: white; border: none; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab(0)">1. API SETUP</button>
        <button class="tab-btn" onclick="switchTab(1)">2. UPLOAD</button>
        <button class="tab-btn" onclick="switchTab(2)">3. PROSES</button>
        <button class="tab-btn" onclick="switchTab(3)">4. HASIL</button>
    </div>

    <div id="t0" class="tab-content active">
        <h2>Konfigurasi Groq AI</h2>
        <div class="input-group">
            <label>Masukkan API Key Anda:</label>
            <input type="password" id="apiKey" placeholder="gsk_xxxxxxxxxxxxxxxx">
            <a href="https://console.groq.com/keys" target="_blank" class="api-link">ðŸ‘‰ Belum punya API Key? Klik di sini untuk buat baru</a>
        </div>
        <button class="btn-main" onclick="saveKey()">Simpan & Lanjut</button>
    </div>

    <div id="t1" class="tab-content">
        <h2>Pilih Foto (Batch)</h2>
        <p>Aplikasi akan otomatis mengompres foto agar proses generate sangat cepat.</p>
        <input type="file" id="filePicker" multiple accept="image/*" onchange="handleFiles(this.files)">
        <div id="countInfo" style="margin-top:15px; font-weight:bold; color:var(--primary);"></div>
        <button class="btn-main" id="btnGoToProses" style="display:none; margin-top:15px;" onclick="switchTab(2)">Lanjut ke Pemrosesan</button>
    </div>

    <div id="t2" class="tab-content">
        <h2>Antrean Proses AI</h2>
        <button class="btn-main" id="startBtn" onclick="startAI()">Mulai Generate Sekarang</button>
        <table>
            <thead><tr><th>Foto</th><th>Nama</th><th>Status</th></tr></thead>
            <tbody id="queueList"></tbody>
        </table>
    </div>

    <div id="t3" class="tab-content">
        <h2>Hasil Metadata</h2>
        <div id="resultsArea"></div>
        <button class="btn-main" style="background:#475569" onclick="location.reload()">Reset & Mulai Lagi</button>
    </div>
</div>

<script>
    let fileQueue = [];
    const MODEL_ID = "meta-llama/llama-4-scout-17b-16e-instruct"; // Model Rekomendasi 2026

    function switchTab(i) {
        document.querySelectorAll('.tab-content').forEach((t, idx) => t.classList.toggle('active', i === idx));
        document.querySelectorAll('.tab-btn').forEach((b, idx) => b.classList.toggle('active', i === idx));
    }

    function saveKey() {
        const k = document.getElementById('apiKey').value.trim();
        if(k.startsWith('gsk_')) {
            localStorage.setItem('GROQ_KEY_2026', k);
            alert("âœ… Berhasil: API Key disimpan.");
            switchTab(1);
        } else { alert("âŒ Error: API Key tidak valid."); }
    }

    if(localStorage.getItem('GROQ_KEY_2026')) document.getElementById('apiKey').value = localStorage.getItem('GROQ_KEY_2026');

    // FUNGSI KOMPRESI (Rahasia Kecepatan)
    async function compressImage(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (event) => {
                const img = new Image();
                img.src = event.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 800; // Ukuran optimal untuk AI Vision
                    let width = img.width;
                    let height = img.height;

                    if (width > MAX_WIDTH) {
                        height *= MAX_WIDTH / width;
                        width = MAX_WIDTH;
                    }
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    resolve(canvas.toDataURL('image/jpeg', 0.7).split(',')[1]); // Kompresi 70%
                };
            };
        });
    }

    async function handleFiles(files) {
        fileQueue = [];
        const list = document.getElementById('queueList');
        list.innerHTML = "";
        
        for(let i=0; i < files.length; i++) {
            const f = files[i];
            const base64Clean = await compressImage(f);
            const preview = URL.createObjectURL(f);
            
            fileQueue.push({ id: i, name: f.name, base64: base64Clean, preview: preview });
            list.innerHTML += `<tr>
                <td><img src="${preview}" class="img-preview"></td>
                <td>${f.name}</td>
                <td id="st-${i}"><span class="status s-wait">Siap</span></td>
            </tr>`;
        }
        document.getElementById('countInfo').innerText = files.length + " Foto berhasil dikompres & siap.";
        document.getElementById('btnGoToProses').style.display = "block";
    }

    async function startAI() {
        const key = localStorage.getItem('GROQ_KEY_2026');
        const btn = document.getElementById('startBtn');
        btn.disabled = true;

        for(let item of fileQueue) {
            const statusEl = document.getElementById(`st-${item.id}`);
            statusEl.innerHTML = `<span class="status s-run">Memproses...</span>`;

            try {
                const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: MODEL_ID,
                        messages: [{
                            role: "user",
                            content: [
                                { type: "text", text: "Task: Microstock Metadata. Format: JSON. Title: 70 chars. Description: 150 chars. Keywords: 40 single words. No technical camera words." },
                                { type: "image_url", image_url: { url: `data:image/jpeg;base64,${item.base64}` } }
                            ]
                        }],
                        response_format: { type: "json_object" }
                    })
                });

                const data = await res.json();
                if(data.error) throw new Error(data.error.message);

                const content = JSON.parse(data.choices[0].message.content);
                const final = formatMetadata(content);
                renderResult(item, final);
                statusEl.innerHTML = `<span class="status s-done">Selesai</span>`;

            } catch (e) {
                console.error(e);
                statusEl.innerHTML = `<span class="status s-err">Gagal: ${e.message.substring(0,15)}</span>`;
            }
            await new Promise(r => setTimeout(r, 1000)); // Jeda 1 detik agar tidak kena blokir
        }
        alert("âœ… Semua foto selesai diproses!");
        switchTab(3);
    }

    function formatMetadata(d) {
        let kw = (Array.isArray(d.keywords) ? d.keywords.join(' ') : String(d.keywords)).toLowerCase();
        let words = kw.replace(/4k|uhd|resolution|hd|shot|camera/g, '').split(/[,\s]+/).filter(w => w.length > 2);
        words = [...new Set(words)];
        
        // Pastikan jumlahnya 40 kata
        const fill = ['background', 'isolated', 'scenery', 'concept', 'view', 'natural', 'nobody', 'outdoor', 'composition', 'daylight'];
        if(words.length > 40) words = words.slice(0, 40);
        else while(words.length < 40) {
            let f = fill[Math.floor(Math.random() * fill.length)];
            if(!words.includes(f)) words.push(f);
        }
        return { title: d.title, desc: d.description, kw: words.join(', ') };
    }

    function renderResult(item, data) {
        const area = document.getElementById('resultsArea');
        const div = document.createElement('div');
        div.className = 'result-item';
        div.innerHTML = `
            <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                <img src="${item.preview}" class="img-preview"> <strong>${item.name}</strong>
            </div>
            <div class="copy-box"><span><strong>Title:</strong> ${data.title}</span><button class="salin-btn" onclick="cp('${data.title.replace(/'/g,"")}')">Salin</button></div>
            <div class="copy-box"><span><strong>Desc:</strong> ${data.desc}</span><button class="salin-btn" onclick="cp('${data.desc.replace(/'/g,"")}')">Salin</button></div>
            <div class="copy-box"><span style="font-size:11px;"><strong>Keywords:</strong> ${data.kw}</span><button class="salin-btn" onclick="cp('${data.kw}')">Salin</button></div>
        `;
        area.appendChild(div);
    }

    function cp(t) {
        navigator.clipboard.writeText(t);
        alert("Tersalin!");
    }
</script>

</body>
</html>
